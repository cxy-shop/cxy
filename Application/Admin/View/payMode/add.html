<style>
    #b-logo-img{
        max-width: 200px;
        max-height: 40px;
        display: none;
    }
</style>
<div class="container-fluid">
    <div class="row">
        <form id="b-add-form" class="col-md-8 col-md-offset-2 form-horizontal" action="/admin/payMode/addHandle" method="post">
            <div class="form-group">
                <label for="b-name" class="col-sm-3 control-label">支付方式名称</label>
                <div class="col-sm-9">
                    <input type="text" class="form-control" id="b-name" name="name" required>
                </div>
            </div>
            <div class="form-group">
                <label for="b-remark" class="col-sm-3 control-label">描述</label>
                <div class="col-sm-9">
                    <textarea class="form-control" name="remark" id="b-remark" cols="30" rows="10"></textarea>
                </div>
            </div>
            <div class="form-group">
                <label for="b-logo-file" class="col-sm-3 control-label">logo</label>
                <div class="col-sm-9">
                    <input type="file" id="b-logo-file" name="file">
                    <img src="" alt="" id="b-logo-img">
                </div>
            </div>
            <div class="form-group">
                <label for="b-enable" class="col-sm-3 control-label">启用</label>
                <div class="col-sm-9">
                    <input type="checkbox" class="form-control" id="b-enable" name="enable" value="1" checked>
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-3 col-sm-9">
                    <input type="hidden" id="b-logo-path" name="logoPath">
                    <button type="submit" class="btn btn-default">提交</button>
                </div>
            </div>
        </form>
    </div>
</div>
<script>
    var update = $("#b-logo-file").kendoUpload({
        async: {
            saveUrl: "/admin/payMode/uploadLogo",
            removeUrl: "/admin/payMode/removeUploadLogo",
            autoUpload: false
        },
        upload: onUpload,   //上传前做些操作
        success: onSuccess, //上传成功时的操作
        remove: onRemove,   //移除文件前操作
        error: onError,      //上传失败时操作
        multiple: false
    }).data("kendoUpload");
    function onUpload(e){
        var files = e.files;
        $.each(files, function () {
            //判断文件类型是否合法
            var extension = this.extension.toLowerCase();
            if ( -1 === $.inArray(extension, ['.jpg', '.gif', '.png', '.jpeg']) ) {
                layer.msg('文件格式不对,只允许jpg,gif,png,jpeg为后缀的图片!');
                e.preventDefault();
            }
            //TODO 还需要检测文件大小是否合法
        });
    }
    function onSuccess(e){
        var files = e.files;
        if (e.operation == "upload") {
            var response = e.response;
            if (response.success == 1){
                console.log(e.files);
                var path = response.data[0].path;
                //修改上传字段值
                $("#b-logo-path").val(path);
                //修改文件名为服务器存储文件名
                e.files[0].name = path;
                //设置缩略图
                $("#b-logo-img").attr('src', '/Static/tmp/'+response.data[0].path).show();
            }
        }else if (e.operation == "remove") {
            //删除缩略图
            $("#b-logo-img").hide().attr('src', '');
            //重置上传字段值
            $("#b-logo-path").val('');
        }

    }
    function onRemove(e){
        var files = e.files;
        console.log(files[0].name);
    }
    function onError(){
        layer.msg('操作失败!');
    }

    $("#b-add-form").submit(function () {
        var that = $(this);
        if ( $.trim($("#b-logo-path").val()) == '' ){
            layer.msg('logo必需上传!');
            return false;
        }
        var action = that.attr('action');
        var submitBtn = that.find('[type=submit]');
        submitBtn.prop('disabled', true);
        $.post(action, that.serialize(), function (obj) {
            console.log(obj);
        }).always(function () {
            submitBtn.prop('disabled', false);
        });
        return false;
    });
</script>
